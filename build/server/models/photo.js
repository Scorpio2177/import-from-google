// Generated by CoffeeScript 1.9.3
var Photo, cozydb, log;

cozydb = require('cozydb');

log = require('printit')({
  date: true,
  prefix: 'model:photos'
});

module.exports = Photo = cozydb.getModel('Photo', {
  id: String,
  title: String,
  description: String,
  orientation: Number,
  binary: function(x) {
    return x;
  },
  _attachments: Object,
  albumid: String,
  date: String
});

Photo.createIfNotExist = function(photo, callback) {
  return Photo.request('byTitle', {
    key: photo.title
  }, function(err, photos) {
    var exist;
    if (err != null) {
      return callback(err);
    }
    log.debug(photo.title + " check if exist");
    if (photos.length > 0) {
      exist = photos[0];
    }
    log.debug("exist ? " + exist);
    if (exist != null) {
      log.info(photo.title + " already imported");
      exist.exist = true;
      return callback(null, exist);
    } else {
      log.info("importing " + photo.title);
      return Photo.create(photo, callback);
    }
  });
};
